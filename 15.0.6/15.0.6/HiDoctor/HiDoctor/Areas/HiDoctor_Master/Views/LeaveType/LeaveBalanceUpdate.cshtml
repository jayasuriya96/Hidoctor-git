@{
    ViewBag.Title = "LeaveBalanceUpdate";
    Layout = null;
}

<link href="~/Content/Bootstrap/bootstrap.css" rel="stylesheet" />
<script src="~/Scripts/Bootstrap/bootstrap.js" type="text/javascript"></script>
<style>
    .mandatory {
        color: red;
    }
</style>
<form action="../HiDoctor_Master/LeaveType/LeaveBalanceUpdateUploadResult" onsubmit="return fnValidateUploadedFile()" method="post" enctype="multipart/form-data" target="ifrmExcel">
    <div class="form-group panel panel-primary" id="dvUserExcelMain">
        <div class="col-lg-12 panel-heading">
            Leave Balance Upload - Excel Upload
        </div>
        <div class="form-group panel-body">
            <div id="dvRules" class="col-sm-6 table-responsive form-group">
                <table>
                    <tr>
                        <td style="text-align: center; font-weight: bold;">Step 1 : Download</td>
                    </tr>
                    <tr>
                        <td>1.Please Download @Html.ActionLink("Leave Balance Upload Excel Template", "DownloadLeaveBalanceExcelTemplate", new { })if you do not have.</td>
                    </tr>
                    <tr>
                        <td>2.Please DownLoad
                            <a href="#" id="aGenerateEmployeeExcel" onclick="fnGenerateEmployeedetailsExcelData();" style="text-decoration: underline;">Employee Details</a>
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <div id="dvDownoadforemployee" style="display: none;">
                                Download 
                                    <a id="lnkEmployeeDownload"></a>&nbsp;file
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>3.Please DownLoad
                            <a href="#" id="aGenerateExcel" onclick="fnGenerateLeaveTypeNameExcelData();" style="text-decoration: underline;">LeaveType Name</a>
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <div id="dvDownoadforLeave">
                                Download 
                                    <a id="lnkLeaveDownload" style="display: none;"></a>&nbsp;file
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>4.Update the Leave Balance Update details in the template</td>
                    </tr>
                    <tr>
                        <td>5.Do not alter the excel file structure(i.e.adding or removing the column)
                        </td>
                    </tr>
                    <tr>
                        <td>6.Do not rename the excel file name and the sheet name
                        </td>
                    </tr>
                    <tr>
                        <td>7.Do not rename the columns
                        </td>
                    </tr>
                    <tr>
                        <td>8.Click the “Choose/Browse file” button to get the file
                        </td>
                    </tr>
                    <tr>
                        <td>9.Click the upload button to upload the data
                        </td>
                    </tr>
                    <tr>
                        <td>10. Below mentioned fields are mandatory <span class="Mandatory" style="color: red;">*</span>
                            <div class="col-lg-12 form-group">
                                <div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        Request Form <span class="mandatory">*</span>
                                    </div>
                                    <div class="col-lg-5 form-group">
                                        @Html.TextBox("txtRequestform")                                        
                                    </div>
                                </div>
                                <div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        Request Date <span class="mandatory">*</span>
                                    </div>
                                    <div class="col-lg-5 form-group">
                                        @Html.TextBox("txtRequestdate")                                       
                                    </div>
                                </div>
                                <div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        Request Reason <span class="mandatory">*</span>
                                    </div>
                                    <div class="col-xs-3">
                                        @Html.TextBox("txtReason")                                        
                                    </div>
                                </div>
                                <div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        Support User Name<span class="mandatory">*</span>
                                    </div>
                                    <div class="col-lg-5 form-group">
                                        @Html.TextBox("txtsupportUserName")                                     
                                    </div>
                                </div>
                                @*<div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        To Email Id <span class="mandatory">*</span>
                                    </div>
                                    <div class="col-lg-5 form-group">
                                        @Html.TextBox("txtmailid")                                      
                                    </div>
                                </div>
                                <div class="col-lg-10 form-group remove-left-padding">
                                    <div class="col-lg-5 form-group">
                                        Email Body <span class="mandatory">*</span>
                                    </div>
                                    <div class="col-lg-5 form-group">
                                        @Html.TextBox("txtemailBody")                                       
                                    </div>
                                </div>*@
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>11.Please do not modify the Row_No column values
                        </td>
                    </tr>
                    <tr>
                        <td>12.Please do not use WRAPTEXT/ALT+ENTER while enter the values. If you use then system will consider this as a special character.
                        </td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-6 form-group">
                <div style="font-weight: bold;" class="col-lg-12">
                    Step 2 : Upload
                </div>
                <div class="col-lg-12 form-group">
                    <input type="file" id="fileUpload" name="fileUpload" accept=".xlsx" />
                    <br />
                    <input type="submit" id="btnUp" value="Upload" class="btn btn-primary" />
                    <label id="lblmessage"></label>
                </div>
                <div id="dvFrame" class="form-group col-lg-12">
                    <iframe name="ifrmExcel"></iframe>
                </div>
                <div id="dvRedirect" class="form-group col-lg-12" style="display: none;">
                    <br />
                    <a href="#" onclick="fnRedirectToBP('LEAVE_BALANCE_UPLOAD');">>>Go to Batch processing</a>
                </div>
                <div style="clear: both;"></div>
            </div>
            <div style="clear: both;"></div>
        </div>
    </div>
</form>

<script src="../../Areas/HiDoctor_Master/Scripts/HD_Master/LeaveType.js?v=@HiDoctor.BuildNumber.BuildNo" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        AjaxGlobalHandler.Initiate();
        $("#dvAjaxLoad").hide();
        $("#txtRequestdate").addClass('datepicker');
        $(".datepicker").datepicker({
            dateFormat: 'dd/mm/yy',
        });
    });

    function fnRedirectToBP(page) {
        $('#main').load('../BatchProcessing/Index?bpType=' + page);
    }

    function fnValidateUploadedFile() {
     
        $("#dvRedirect").hide();
        $("#dvMsgSuccess").hide();
        $("#dvMsgError").hide();
        $("#dvMsgError").html('');
        $("#dvMsgSuccess").html('');
        var fileName = $('#fileUpload').val();
        var errMsg = "";
        if (fileName.length == 0) {
            errMsg += "Please select any excel file then click the upload button<br />";
            //fnMsgAlert('info', 'Info', 'Please select any excel file then click the upload button');          
        }
        else if (fileName.substring(fileName.lastIndexOf('.') + 1) != "xlsx") {
            errMsg += "Please select xlsx file only <br/>";
        }

        else if ($.trim($("#txtRequestform").val()) == "") {
            errMsg += "Enter The Request Form <br>";
        }

        else if ($.trim($("#txtRequestform").val()).length == 0) {
            errMsg += "Enter The Request Form </br>";
        }

        else if (!(isNaN($("#txtRequestform").val()))) {
            errMsg += "Enter The valid Request Form <br/>";
        }

        else if (!regExforAlphaNumeric($("#txtRequestform").val())) {
            errMsg += "Special characters are not allowed in the Request Form <br/>";
        }

        else if ($.trim($("#txtRequestdate").val()) == "") {
            errMsg += "Enter The Request Date <br/>";
        }

        else if ($.trim($("#txtReason").val()) == "") {
            errMsg += "Enter The Request Reason <br/>";
        }

        else if ($.trim($("#txtsupportUserName").val()) == "") {
            errMsg += "Enter The Support Name <br/>";
        }

        //else if ($.trim($("#txtmailid").val()) == "") {
        //    errMsg += "Enter The Mail Id <br/>";
        //}

        //else if ($.trim($("#txtemailBody").val()) == "") {
        //    errMsg += "Enter The Mail Body <br/>";
        //}
        if (!(fnValidateDateFormate($("#txtRequestdate"), "RequestDate"))) {
            errMsg += "Enter The Valid Date <br/>";
        }
        if ($.trim(errMsg).length > 0) {
            fnMsgAlert('info', 'Info', errMsg);
            return false;
        }
        return true;
    }

</script>


